# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è©³ç´°

## å…¨ä½“ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Claude Runner èµ·å‹•                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. åˆæœŸåŒ–ãƒ•ã‚§ãƒ¼ã‚º                                              â”‚
â”‚    - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿                                      â”‚
â”‚    - ç’°å¢ƒå¤‰æ•°å±•é–‹                                              â”‚
â”‚    - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³                                            â”‚
â”‚    - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–ï¼ˆGitHub, Claudeï¼‰                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Issueå–å¾—ãƒ•ã‚§ãƒ¼ã‚º                                           â”‚
â”‚    - ç‰¹å®šIssueæŒ‡å®šã®ç¢ºèªï¼ˆ--issue ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰                 â”‚
â”‚    - GitHub API ã§ Issue å–å¾—ï¼ˆä¸€è¦§ or å˜ä¸€ï¼‰                 â”‚
â”‚    - ãƒ©ãƒ™ãƒ«ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°                                    â”‚
â”‚    - é™¤å¤–ãƒ©ãƒ™ãƒ«ã®é©ç”¨                                          â”‚
â”‚    - å„ªå…ˆåº¦ã§ã‚½ãƒ¼ãƒˆ                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Issueå‡¦ç†ãƒ«ãƒ¼ãƒ—                                            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚ å„ Issue ã«ã¤ã„ã¦:                                   â”‚   â”‚
â”‚    â”‚   - Worktreeä½œæˆ                                    â”‚   â”‚
â”‚    â”‚   - å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚   â”‚
â”‚    â”‚   - ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ•ã‚§ãƒ¼ã‚º       â”‚                         â”‚   â”‚
â”‚    â”‚   - ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ            â”‚â† ãƒªãƒˆãƒ©ã‚¤ãƒ«ãƒ¼ãƒ—          â”‚   â”‚
â”‚    â”‚   - ã‚³ãƒŸãƒƒãƒˆ              â”‚  (reviewIterationså›)   â”‚   â”‚
â”‚    â”‚   - Pushï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰    â”‚                         â”‚   â”‚
â”‚    â”‚   - PRä½œæˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰   â”‚                         â”‚   â”‚
â”‚    â”‚   - Worktreeå‰Šé™¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. å®Œäº†ãƒ»ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—                                        â”‚
â”‚    - çµ±è¨ˆãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›                                          â”‚
â”‚    - é€šçŸ¥é€ä¿¡ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰                                    â”‚
â”‚    - ãƒªã‚½ãƒ¼ã‚¹è§£æ”¾                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 1. åˆæœŸåŒ–ãƒ•ã‚§ãƒ¼ã‚º

### 1.1 è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿

```typescript
async function initialize(): Promise<Context> {
  // è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®æ±ºå®š
  const configPath = process.env.CLAUDE_RUNNER_CONFIG ||
                     path.join(process.cwd(), 'config.yaml');

  // YAMLèª­ã¿è¾¼ã¿
  const rawConfig = await fs.readFile(configPath, 'utf-8');
  const parsedConfig = yaml.parse(rawConfig);

  // ç’°å¢ƒå¤‰æ•°å±•é–‹
  const expandedConfig = expandEnvVars(parsedConfig);

  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  const config = configSchema.parse(expandedConfig);

  logger.info('è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿å®Œäº†', { configPath });

  return {
    config,
    githubClient: new GitHubClient(config.github),
    claudeClient: new ClaudeClient(config.claude),
    gitManager: new GitManager(config.git),
    stats: new Statistics(),
  };
}
```

### 1.2 ç’°å¢ƒå¤‰æ•°å±•é–‹

```typescript
function expandEnvVars(obj: any): any {
  if (typeof obj === 'string') {
    // ${VAR_NAME} å½¢å¼ã‚’å±•é–‹
    return obj.replace(/\$\{([^}]+)\}/g, (_, varName) => {
      const value = process.env[varName];
      if (!value) {
        throw new Error(`ç’°å¢ƒå¤‰æ•° ${varName} ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“`);
      }
      return value;
    });
  }

  if (Array.isArray(obj)) {
    return obj.map(expandEnvVars);
  }

  if (obj && typeof obj === 'object') {
    return Object.fromEntries(
      Object.entries(obj).map(([k, v]) => [k, expandEnvVars(v)])
    );
  }

  return obj;
}
```

### 1.3 ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–

```typescript
class GitHubClient {
  private octokit: Octokit;

  constructor(config: GitHubConfig) {
    this.octokit = new Octokit({
      auth: config.token,
      throttle: {
        onRateLimit: (retryAfter, options) => {
          logger.warn(`GitHub APIãƒ¬ãƒ¼ãƒˆåˆ¶é™åˆ°é”ã€${retryAfter}ç§’å¾Œã«ãƒªãƒˆãƒ©ã‚¤`);
          return true; // ãƒªãƒˆãƒ©ã‚¤ã™ã‚‹
        },
        onSecondaryRateLimit: (retryAfter, options) => {
          logger.warn(`GitHub APIäºŒæ¬¡ãƒ¬ãƒ¼ãƒˆåˆ¶é™åˆ°é”`);
          return true;
        },
      },
    });
  }
}

class ClaudeClient {
  private anthropic: Anthropic;

  constructor(config: ClaudeConfig) {
    this.anthropic = new Anthropic({
      apiKey: config.apiKey,
      timeout: config.timeout,
      maxRetries: config.maxRetries,
    });
  }
}
```

## 2. Issueå–å¾—ãƒ•ã‚§ãƒ¼ã‚º

### 2.1 Issueå–å¾—ï¼ˆä¸€è¦§ or å˜ä¸€ï¼‰

ç‰¹å®šã®Issueç•ªå·ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ã€ãã®Issueã®ã¿ã‚’å–å¾—ã—ã¾ã™ã€‚

```typescript
async function fetchIssues(
  context: Context,
  options: { issueNumber?: number }
): Promise<Issue[]> {
  const { githubClient, config } = context;

  // ç‰¹å®šIssueç•ªå·ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆ
  if (options.issueNumber) {
    logger.info(`Issue #${options.issueNumber} ã‚’å–å¾—ä¸­...`);

    const issue = await githubClient.getIssue({
      owner: config.github.owner,
      repo: config.github.repo,
      issue_number: options.issueNumber,
    });

    // IssueãŒé–‰ã˜ã¦ã„ã‚‹å ´åˆã¯ã‚¨ãƒ©ãƒ¼
    if (issue.state !== 'open') {
      throw new Error(`Issue #${options.issueNumber} ã¯æ—¢ã«é–‰ã˜ã‚‰ã‚Œã¦ã„ã¾ã™`);
    }

    logger.info(`âœ“ Issue #${issue.number}: ${issue.title}`);
    return [issue];
  }

  // ä¸€è¦§å–å¾—ï¼ˆé€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼‰
  logger.info('Issueä¸€è¦§ã‚’å–å¾—ä¸­...', {
    labels: config.github.labels,
  });

  const issues = await githubClient.getIssues({
    owner: config.github.owner,
    repo: config.github.repo,
    state: 'open',
    labels: config.github.labels.join(','),
    sort: 'created',
    direction: 'asc',
    per_page: 100,
  });

  logger.info(`${issues.length} ä»¶ã®Issueã‚’å–å¾—ã—ã¾ã—ãŸ`);

  return issues;
}
```

**ä½¿ç”¨ä¾‹**:
```bash
# å…¨ã¦ã®issueã‚’å‡¦ç†
claude-runner --config config.yaml

# ç‰¹å®šã®issueã®ã¿å‡¦ç†
claude-runner --config config.yaml --issue 123
```

### 2.2 ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¨ã‚½ãƒ¼ãƒˆ

```typescript
function filterAndSortIssues(
  issues: Issue[],
  config: Config
): Issue[] {
  // é™¤å¤–ãƒ©ãƒ™ãƒ«ã§ãƒ•ã‚£ãƒ«ã‚¿
  let filtered = issues.filter(issue => {
    const hasExcludedLabel = issue.labels.some(label =>
      config.github.excludeLabels?.includes(label.name)
    );
    return !hasExcludedLabel;
  });

  // ã‚¢ã‚µã‚¤ãƒ³æ¸ˆã¿ã‚’é™¤å¤–
  filtered = filtered.filter(issue => !issue.assignee);

  // æ—¢ã«å‡¦ç†ä¸­/å®Œäº†ã®ã‚‚ã®ã‚’é™¤å¤–
  filtered = filtered.filter(issue => {
    const hasProcessingLabel = issue.labels.some(label =>
      ['claude-processing', 'claude-completed', 'claude-failed'].includes(label.name)
    );
    return !hasProcessingLabel;
  });

  // å„ªå…ˆåº¦ã§ã‚½ãƒ¼ãƒˆï¼ˆãƒ©ãƒ™ãƒ«ã« priority-high ãªã©ãŒã‚ã‚Œã°å„ªå…ˆï¼‰
  const sorted = filtered.sort((a, b) => {
    const aPriority = getPriority(a);
    const bPriority = getPriority(b);
    return bPriority - aPriority; // é«˜ã„å„ªå…ˆåº¦ãŒå…ˆ
  });

  logger.info(`ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å¾Œ: ${sorted.length} ä»¶ã®Issue`);

  return sorted;
}

function getPriority(issue: Issue): number {
  if (issue.labels.some(l => l.name === 'priority-high')) return 3;
  if (issue.labels.some(l => l.name === 'priority-medium')) return 2;
  if (issue.labels.some(l => l.name === 'priority-low')) return 1;
  return 0;
}
```

### 2.3 ç«¶åˆæ¤œçŸ¥ã¨å®Ÿè¡Œã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ

Issue é–“ã®ç«¶åˆã‚’æ¤œå‡ºã—ã€å®‰å…¨ã«ä¸¦åˆ—å®Ÿè¡Œã§ãã‚‹ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆã—ã¾ã™ã€‚

#### ãªãœç«¶åˆæ¤œçŸ¥ãŒå¿…è¦ã‹

è¤‡æ•°ã® Issue ã‚’ä¸¦åˆ—å‡¦ç†ã™ã‚‹ã¨åŠ¹ç‡çš„ã§ã™ãŒã€ä»¥ä¸‹ã®ã‚ˆã†ãªç«¶åˆãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼š

1. **æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã®ç«¶åˆ**: Next.js ã¨ Nuxt.js ã‚’åŒæ™‚ã«å°å…¥
2. **ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†ã®ç«¶åˆ**: åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¤‡æ•°ã® Issue ãŒå¤‰æ›´
3. **ä¾å­˜é–¢ä¿‚ã®ç«¶åˆ**: package.json ã‚’åŒæ™‚ã«å¤‰æ›´
4. **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ç«¶åˆ**: tsconfig.json ãªã©ã‚’åŒæ™‚ã«å¤‰æ›´

#### ç«¶åˆæ¤œçŸ¥ã®å®Ÿè£…

```typescript
async function detectConflictsAndGroup(
  issues: Issue[]
): Promise<IssueGroup[]> {
  const detector = new ConflictDetector();

  logger.info('Issue é–“ã®ç«¶åˆã‚’æ¤œçŸ¥ä¸­...');

  // å„ Issue ã®å½±éŸ¿ç¯„å›²ã‚’åˆ†æ
  const scopes = await Promise.all(
    issues.map(issue => detector.analyzeIssueScope(issue))
  );

  logger.debug('åˆ†æçµæœ:', scopes.map(s => ({
    issue: s.issueNumber,
    techStack: Array.from(s.techStack),
    filePatterns: Array.from(s.filePatterns),
    dependencyChange: s.dependencyChange,
    configChange: s.configChange,
  })));

  // ç«¶åˆã‚’æ¤œå‡º
  const conflicts = new Map<number, Set<number>>();

  for (let i = 0; i < scopes.length; i++) {
    for (let j = i + 1; j < scopes.length; j++) {
      if (detector.hasConflict(scopes[i], scopes[j])) {
        if (!conflicts.has(i)) conflicts.set(i, new Set());
        if (!conflicts.has(j)) conflicts.set(j, new Set());
        conflicts.get(i)!.add(j);
        conflicts.get(j)!.add(i);

        logger.warn(
          `ç«¶åˆæ¤œå‡º: Issue #${issues[i].number} ã¨ Issue #${issues[j].number}`
        );
      }
    }
  }

  // å®Ÿè¡Œã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆ
  const groups = detector.createExecutionGroups(issues, conflicts);

  logger.info(`å®Ÿè¡Œã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆå®Œäº†: ${groups.length}ã‚°ãƒ«ãƒ¼ãƒ—`);
  groups.forEach((group, i) => {
    const issueNumbers = group.issues.map(issue => `#${issue.number}`).join(', ');
    logger.info(
      `  ã‚°ãƒ«ãƒ¼ãƒ— ${i + 1}: ${group.parallel ? 'ä¸¦åˆ—' : 'é †æ¬¡'} - ${issueNumbers}`
    );
  });

  return groups;
}
```

#### ç«¶åˆæ¤œçŸ¥ã®ä¾‹

**ã‚±ãƒ¼ã‚¹1: æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã®ç«¶åˆ**
```typescript
// Issue #100: "Add Next.js to the project"
// Issue #101: "Migrate to Nuxt.js"
// â†’ ç«¶åˆ! é †æ¬¡å®Ÿè¡Œ

const scope100 = {
  issueNumber: 100,
  techStack: new Set(['nextjs']),
  filePatterns: new Set(['next.config.js', 'pages/**/*']),
  dependencyChange: true,
  configChange: false,
};

const scope101 = {
  issueNumber: 101,
  techStack: new Set(['nuxtjs']),
  filePatterns: new Set(['nuxt.config.js', 'pages/**/*']),
  dependencyChange: true,
  configChange: false,
};

// hasConflict(scope100, scope101) â†’ true
// ç†ç”±: Next.js ã¨ Nuxt.js ã¯å…±å­˜ã§ããªã„
```

**ã‚±ãƒ¼ã‚¹2: ãƒ•ã‚¡ã‚¤ãƒ«ã®ç«¶åˆ**
```typescript
// Issue #200: "Update Button component"
// Issue #201: "Refactor Button styles"
// â†’ ç«¶åˆ! é †æ¬¡å®Ÿè¡Œ

const scope200 = {
  issueNumber: 200,
  techStack: new Set(['react']),
  filePatterns: new Set(['src/components/Button.tsx']),
  dependencyChange: false,
  configChange: false,
};

const scope201 = {
  issueNumber: 201,
  techStack: new Set(['react']),
  filePatterns: new Set(['src/components/Button.tsx']),
  dependencyChange: false,
  configChange: false,
};

// hasConflict(scope200, scope201) â†’ true
// ç†ç”±: åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´
```

**ã‚±ãƒ¼ã‚¹3: ç«¶åˆãªã—**
```typescript
// Issue #300: "Add Footer component"
// Issue #301: "Add Header component"
// â†’ ç«¶åˆãªã—! ä¸¦åˆ—å®Ÿè¡Œå¯èƒ½

const scope300 = {
  issueNumber: 300,
  techStack: new Set(['react']),
  filePatterns: new Set(['src/components/Footer.tsx']),
  dependencyChange: false,
  configChange: false,
};

const scope301 = {
  issueNumber: 301,
  techStack: new Set(['react']),
  filePatterns: new Set(['src/components/Header.tsx']),
  dependencyChange: false,
  configChange: false,
};

// hasConflict(scope300, scope301) â†’ false
// ç†ç”±: ç•°ãªã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å¤‰æ›´ã€æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ã‚‚å…±é€š
```

#### ã‚°ãƒ«ãƒ¼ãƒ—å®Ÿè¡Œæˆ¦ç•¥

```typescript
async function executeGroups(
  groups: IssueGroup[],
  context: Context
): Promise<void> {
  const { config } = context;

  for (const [index, group] of groups.entries()) {
    logger.info(`\n${'='.repeat(60)}`);
    logger.info(`ã‚°ãƒ«ãƒ¼ãƒ— ${index + 1}/${groups.length} ã®å®Ÿè¡Œ`);
    logger.info(`å®Ÿè¡Œãƒ¢ãƒ¼ãƒ‰: ${group.parallel ? 'ä¸¦åˆ—' : 'é †æ¬¡'}`);
    logger.info(`Issueæ•°: ${group.issues.length}`);
    logger.info(`${'='.repeat(60)}\n`);

    if (group.parallel && config.workflow.maxConcurrency > 1) {
      // ä¸¦åˆ—å®Ÿè¡Œ
      logger.info('ä¸¦åˆ—å®Ÿè¡Œé–‹å§‹...');

      const results = await Promise.allSettled(
        group.issues.map(issue => processIssue(issue, context))
      );

      // çµæœã‚’é›†è¨ˆ
      const succeeded = results.filter(r => r.status === 'fulfilled').length;
      const failed = results.filter(r => r.status === 'rejected').length;

      logger.info(`ä¸¦åˆ—å®Ÿè¡Œå®Œäº†: æˆåŠŸ ${succeeded}ä»¶, å¤±æ•— ${failed}ä»¶`);

    } else {
      // é †æ¬¡å®Ÿè¡Œ
      logger.info('é †æ¬¡å®Ÿè¡Œé–‹å§‹...');

      for (const issue of group.issues) {
        try {
          await processIssue(issue, context);
        } catch (error) {
          logger.error(`Issue #${issue.number} ã®å‡¦ç†ã«å¤±æ•—:`, error);
          // æ¬¡ã® Issue ã«ç¶šè¡Œ
        }
      }

      logger.info('é †æ¬¡å®Ÿè¡Œå®Œäº†');
    }
  }
}
```

#### ãƒ¡ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼ã§ã®ä½¿ç”¨

```typescript
async function run(
  context: Context,
  options: { issueNumber?: number }
): Promise<Report> {
  const { config, githubClient } = context;

  // 1. Issue å–å¾—ï¼ˆä¸€è¦§ or å˜ä¸€ï¼‰
  const issues = await fetchIssues(context, options);

  // ç‰¹å®šIssueæŒ‡å®šã®å ´åˆã¯ã€ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¨ç«¶åˆæ¤œçŸ¥ã‚’ã‚¹ã‚­ãƒƒãƒ—
  if (options.issueNumber) {
    logger.info(`ç‰¹å®šIssue #${options.issueNumber} ã®ã¿å‡¦ç†ã—ã¾ã™`);

    // ç›´æ¥å‡¦ç†
    await processIssue(issues[0]!, context);

    return context.stats.generateReport();
  }

  // 2. ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã¨ã‚½ãƒ¼ãƒˆï¼ˆé€šå¸¸ãƒ¢ãƒ¼ãƒ‰ï¼‰
  const filtered = filterAndSortIssues(issues, config);

  if (filtered.length === 0) {
    logger.info('å‡¦ç†å¯¾è±¡ã® Issue ãŒã‚ã‚Šã¾ã›ã‚“');
    return context.stats.generateReport();
  }

  // 3. ç«¶åˆæ¤œçŸ¥ã¨å®Ÿè¡Œã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ
  const groups = await detectConflictsAndGroup(filtered);

  // 4. ã‚°ãƒ«ãƒ¼ãƒ—ã”ã¨ã«å®Ÿè¡Œ
  await executeGroups(groups, context);

  // 5. ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
  return context.stats.generateReport();
}
```

**ç‰¹å®šIssueæŒ‡å®šæ™‚ã®å‹•ä½œ**:
- ãƒ©ãƒ™ãƒ«ãƒã‚§ãƒƒã‚¯ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆæŒ‡å®šã•ã‚ŒãŸIssueã‚’å¿…ãšå‡¦ç†ï¼‰
- ç«¶åˆæ¤œçŸ¥ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆå˜ä¸€Issueãªã®ã§ç«¶åˆãªã—ï¼‰
- å³åº§ã«å‡¦ç†é–‹å§‹

## 3. Issueå‡¦ç†ãƒ«ãƒ¼ãƒ—

### 3.1 å‡¦ç†å‰ã®æº–å‚™

```typescript
async function processIssue(
  issue: Issue,
  context: Context
): Promise<ProcessResult> {
  const { config, githubClient, gitManager, claudeClient, stats } = context;

  const startTime = Date.now();
  const issueNumber = issue.number;

  logger.info(`\n${'='.repeat(60)}`);
  logger.info(`Issue #${issueNumber} ã®å‡¦ç†ã‚’é–‹å§‹`);
  logger.info(`ã‚¿ã‚¤ãƒˆãƒ«: ${issue.title}`);
  logger.info(`${'='.repeat(60)}\n`);

  // å‡¦ç†ä¸­ãƒ©ãƒ™ãƒ«è¿½åŠ 
  await githubClient.addLabel(issueNumber, 'claude-processing');

  // Worktreeãƒ‘ã‚¹ã¨ãƒ–ãƒ©ãƒ³ãƒåæ±ºå®š
  const worktreePath = path.join(
    config.git.worktreeDir,
    `issue-${issueNumber}`
  );
  const branchName = `${config.git.branchPrefix}${issueNumber}`;

  try {
    // Worktreeä½œæˆ
    await gitManager.createWorktree({
      branch: branchName,
      path: worktreePath,
      baseBranch: config.git.baseBranch,
    });

    logger.info(`Worktreeä½œæˆå®Œäº†: ${worktreePath}`);

    // å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º
    const implementResult = await implementPhase(
      issue,
      worktreePath,
      context
    );

    // ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ•ã‚§ãƒ¼ã‚º
    if (config.workflow.autoReview) {
      await reviewPhase(issue, worktreePath, context);
    }

    // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    if (config.workflow.runTests) {
      await testPhase(worktreePath, context);
    }

    // ã‚³ãƒŸãƒƒãƒˆ
    await commitPhase(issue, worktreePath, context);

    // Push
    if (config.workflow.autoPush) {
      await pushPhase(branchName, worktreePath, context);
    }

    // PRä½œæˆ
    if (config.workflow.autoCreatePR) {
      await createPRPhase(issue, branchName, context);
    }

    // æˆåŠŸãƒ©ãƒ™ãƒ«
    await githubClient.removeLabel(issueNumber, 'claude-processing');
    await githubClient.addLabel(issueNumber, 'claude-completed');

    const duration = Date.now() - startTime;
    stats.recordSuccess(issueNumber, duration);

    logger.info(`\nâœ“ Issue #${issueNumber} ã®å‡¦ç†å®Œäº† (${duration}ms)\n`);

    return { success: true, issueNumber, duration };

  } catch (error) {
    // ã‚¨ãƒ©ãƒ¼å‡¦ç†
    return await handleError(error, issue, context, startTime);

  } finally {
    // Worktreeå‰Šé™¤
    try {
      await gitManager.removeWorktree(worktreePath);
      logger.info(`Worktreeå‰Šé™¤å®Œäº†: ${worktreePath}`);
    } catch (error) {
      logger.error(`Worktreeå‰Šé™¤å¤±æ•—: ${error.message}`);
    }
  }
}
```

### 3.2 å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚º

```typescript
async function implementPhase(
  issue: Issue,
  worktreePath: string,
  context: Context
): Promise<ImplementResult> {
  const { claudeClient, config } = context;

  logger.info('å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚ºé–‹å§‹');

  // Issueã®å†…å®¹ã‚’æ•´å½¢
  const prompt = buildImplementPrompt(issue, worktreePath);

  // Claudeã«å®Ÿè£…ä¾é ¼
  const result = await claudeClient.implement({
    prompt,
    worktreePath,
    model: config.claude.model,
    temperature: config.claude.temperature,
    maxTokens: config.claude.maxTokens,
  });

  logger.info('å®Ÿè£…ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†', {
    filesChanged: result.filesChanged,
    tokensUsed: result.tokensUsed,
  });

  return result;
}

function buildImplementPrompt(issue: Issue, worktreePath: string): string {
  return `
ã‚ãªãŸã¯å„ªç§€ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã™ã€‚
ä»¥ä¸‹ã®GitHub Issueã‚’å®Ÿè£…ã—ã¦ãã ã•ã„ã€‚

# Issueæƒ…å ±
- Issueç•ªå·: #${issue.number}
- ã‚¿ã‚¤ãƒˆãƒ«: ${issue.title}
- æœ¬æ–‡:
${issue.body}

# ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
${worktreePath}

# å®Ÿè£…è¦ä»¶
1. æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ã¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã«å¾“ã£ã¦ãã ã•ã„
2. å¿…è¦ã«å¿œã˜ã¦ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„
3. ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã‚’è€ƒæ…®ã—ã¦ãã ã•ã„
4. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã«æ³¨æ„ã—ã¦ãã ã•ã„
5. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ã—ã¦ãã ã•ã„

# æˆæœç‰©
- å®Ÿè£…ã«å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´
- ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ï¼ˆå¿…è¦ãªå ´åˆï¼‰
- ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆè¤‡é›‘ãªãƒ­ã‚¸ãƒƒã‚¯ã®å ´åˆï¼‰

å®Ÿè£…ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚
`.trim();
}
```

### 3.3 ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ•ã‚§ãƒ¼ã‚º

```typescript
async function reviewPhase(
  issue: Issue,
  worktreePath: string,
  context: Context
): Promise<void> {
  const { claudeClient, gitManager, config } = context;
  const maxIterations = config.workflow.reviewIterations;

  logger.info('ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ•ã‚§ãƒ¼ã‚ºé–‹å§‹');

  for (let iteration = 1; iteration <= maxIterations; iteration++) {
    logger.info(`ãƒ¬ãƒ“ãƒ¥ãƒ¼ ${iteration}/${maxIterations} å›ç›®`);

    // å¤‰æ›´å·®åˆ†ã‚’å–å¾—
    const diff = await gitManager.getDiff(worktreePath);

    if (!diff) {
      logger.warn('å¤‰æ›´ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ');
      break;
    }

    // Claudeã«ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼
    const reviewResult = await claudeClient.review({
      diff,
      issue,
      worktreePath,
    });

    logger.info('ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœ:', {
      issuesFound: reviewResult.issues.length,
      suggestions: reviewResult.suggestions.length,
    });

    // å•é¡ŒãŒãªã‘ã‚Œã°çµ‚äº†
    if (reviewResult.issues.length === 0) {
      logger.info('âœ“ ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Œäº†: å•é¡Œãªã—');
      break;
    }

    // æœ€å¾Œã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ä¿®æ­£ã—ãªã„
    if (iteration === maxIterations) {
      logger.warn('æœ€å¤§ãƒ¬ãƒ“ãƒ¥ãƒ¼å›æ•°ã«é”ã—ã¾ã—ãŸã€‚ä»¥ä¸‹ã®å•é¡ŒãŒæ®‹ã£ã¦ã„ã¾ã™:');
      reviewResult.issues.forEach((issue, i) => {
        logger.warn(`  ${i + 1}. ${issue}`);
      });
      break;
    }

    // å•é¡Œã‚’ä¿®æ­£
    logger.info('å•é¡Œç‚¹ã‚’ä¿®æ­£ä¸­...');
    await claudeClient.implementFixes({
      issues: reviewResult.issues,
      suggestions: reviewResult.suggestions,
      worktreePath,
    });

    // å¤‰æ›´ã‚’ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°
    await gitManager.stageAll(worktreePath);
  }

  logger.info('ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†');
}
```

### 3.4 ãƒ†ã‚¹ãƒˆãƒ•ã‚§ãƒ¼ã‚º

```typescript
async function testPhase(
  worktreePath: string,
  context: Context
): Promise<void> {
  const { config } = context;

  logger.info('ãƒ†ã‚¹ãƒˆãƒ•ã‚§ãƒ¼ã‚ºé–‹å§‹');

  try {
    // ãƒ“ãƒ«ãƒ‰ï¼ˆå¿…è¦ãªå ´åˆï¼‰
    if (config.workflow.buildBeforeTest) {
      logger.info('ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œä¸­...');
      await execInWorktree(
        worktreePath,
        config.workflow.buildCommand
      );
      logger.info('âœ“ ãƒ“ãƒ«ãƒ‰æˆåŠŸ');
    }

    // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
    logger.info('ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...');
    const testResult = await execInWorktree(
      worktreePath,
      config.workflow.testCommand
    );

    logger.info('âœ“ ãƒ†ã‚¹ãƒˆæˆåŠŸ');
    logger.debug('ãƒ†ã‚¹ãƒˆçµæœ:', testResult);

  } catch (error) {
    logger.error('âœ— ãƒ†ã‚¹ãƒˆå¤±æ•—');
    throw new TestFailureError(
      `ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`,
      error.stdout,
      error.stderr
    );
  }
}

async function execInWorktree(
  worktreePath: string,
  command: string
): Promise<ExecResult> {
  const { stdout, stderr } = await exec(command, {
    cwd: worktreePath,
    maxBuffer: 10 * 1024 * 1024, // 10MB
  });

  return { stdout, stderr };
}
```

### 3.5 ã‚³ãƒŸãƒƒãƒˆãƒ•ã‚§ãƒ¼ã‚º

```typescript
async function commitPhase(
  issue: Issue,
  worktreePath: string,
  context: Context
): Promise<void> {
  const { gitManager, config } = context;

  logger.info('ã‚³ãƒŸãƒƒãƒˆãƒ•ã‚§ãƒ¼ã‚ºé–‹å§‹');

  // å¤‰æ›´ãŒã‚ã‚‹ã‹ç¢ºèª
  const hasChanges = await gitManager.hasChanges(worktreePath);
  if (!hasChanges) {
    throw new Error('ã‚³ãƒŸãƒƒãƒˆã™ã‚‹å¤‰æ›´ãŒã‚ã‚Šã¾ã›ã‚“');
  }

  // ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
  const message = buildCommitMessage(issue, config);

  // ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã¨ã‚³ãƒŸãƒƒãƒˆ
  await gitManager.stageAll(worktreePath);
  await gitManager.commit(worktreePath, message);

  logger.info('âœ“ ã‚³ãƒŸãƒƒãƒˆå®Œäº†');
}

function buildCommitMessage(issue: Issue, config: Config): string {
  const template = config.git.commitMessageTemplate;

  // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå¤‰æ•°ã‚’å±•é–‹
  return template
    .replace(/\{\{issue_number\}\}/g, issue.number.toString())
    .replace(/\{\{issue_title\}\}/g, issue.title)
    .replace(/\{\{issue_body\}\}/g, truncate(issue.body, 200));
}

function truncate(text: string, maxLength: number): string {
  if (text.length <= maxLength) return text;
  return text.substring(0, maxLength) + '...';
}
```

### 3.6 Pushãƒ•ã‚§ãƒ¼ã‚º

```typescript
async function pushPhase(
  branchName: string,
  worktreePath: string,
  context: Context
): Promise<void> {
  const { gitManager } = context;

  logger.info('Pushãƒ•ã‚§ãƒ¼ã‚ºé–‹å§‹');

  try {
    await gitManager.push(worktreePath, 'origin', branchName);
    logger.info(`âœ“ Pushå®Œäº†: origin/${branchName}`);
  } catch (error) {
    if (error.message.includes('remote contains work')) {
      logger.warn('ãƒªãƒ¢ãƒ¼ãƒˆãƒ–ãƒ©ãƒ³ãƒãŒæ—¢ã«å­˜åœ¨ã—ã¾ã™ã€‚force pushã‚’è©¦ã¿ã¾ã™...');
      await gitManager.push(worktreePath, 'origin', branchName, { force: true });
      logger.info('âœ“ Force pushå®Œäº†');
    } else {
      throw error;
    }
  }
}
```

### 3.7 PRä½œæˆãƒ•ã‚§ãƒ¼ã‚º

```typescript
async function createPRPhase(
  issue: Issue,
  branchName: string,
  context: Context
): Promise<PullRequest> {
  const { githubClient, gitManager, config } = context;

  logger.info('PRä½œæˆãƒ•ã‚§ãƒ¼ã‚ºé–‹å§‹');

  // PRæœ¬æ–‡ç”Ÿæˆ
  const body = buildPRBody(issue, gitManager);

  // PRä½œæˆ
  const pr = await githubClient.createPR({
    owner: config.github.owner,
    repo: config.github.repo,
    title: `Fix #${issue.number}: ${issue.title}`,
    body,
    base: config.git.baseBranch,
    head: branchName,
  });

  logger.info(`âœ“ PRä½œæˆå®Œäº†: ${pr.html_url}`);

  // Issueã«ã‚³ãƒ¡ãƒ³ãƒˆ
  await githubClient.addComment(
    issue.number,
    `ğŸ¤– ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸ: ${pr.html_url}`
  );

  return pr;
}

function buildPRBody(issue: Issue, gitManager: GitManager): string {
  return `
## æ¦‚è¦
Closes #${issue.number}

${issue.body}

## å®Ÿè£…å†…å®¹
Claude ã«ã‚ˆã‚‹è‡ªå‹•å®Ÿè£…ã¨ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå®Œäº†ã—ã¾ã—ãŸã€‚

## ãƒ†ã‚¹ãƒˆ
- [x] è‡ªå‹•ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ¸ˆã¿
- [ ] æ‰‹å‹•ãƒ†ã‚¹ãƒˆï¼ˆãƒ¬ãƒ“ãƒ¥ã‚¢ãƒ¼ã«ã‚ˆã‚‹ç¢ºèªï¼‰

## ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- [x] ã‚³ãƒ¼ãƒ‰ãŒæ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ã«å¾“ã£ã¦ã„ã‚‹
- [x] ãƒ†ã‚¹ãƒˆãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ï¼ˆå¿…è¦ãªå ´åˆï¼‰
- [x] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹ï¼ˆå¿…è¦ãªå ´åˆï¼‰

---
ğŸ¤– Generated by [Claude Runner](https://github.com/your-org/claude-runner)
`.trim();
}
```

## 4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 4.1 ã‚¨ãƒ©ãƒ¼åˆ†é¡

```typescript
class ErrorHandler {
  async handle(
    error: Error,
    issue: Issue,
    context: Context,
    startTime: number
  ): Promise<ProcessResult> {
    const { githubClient, stats } = context;
    const duration = Date.now() - startTime;

    // ã‚¨ãƒ©ãƒ¼åˆ†é¡
    const errorType = this.classifyError(error);

    logger.error(`Error type: ${errorType}`, { error });

    // Issueã«ã‚³ãƒ¡ãƒ³ãƒˆ
    await this.commentOnIssue(issue.number, error, errorType, githubClient);

    // ãƒ©ãƒ™ãƒ«æ›´æ–°
    await githubClient.removeLabel(issue.number, 'claude-processing');
    await githubClient.addLabel(issue.number, 'claude-failed');
    await githubClient.addLabel(issue.number, `error:${errorType}`);

    // çµ±è¨ˆè¨˜éŒ²
    stats.recordFailure(issue.number, errorType, duration);

    // é€šçŸ¥é€ä¿¡
    await this.sendNotification(issue, error, errorType, context);

    return {
      success: false,
      issueNumber: issue.number,
      error: error.message,
      errorType,
      duration,
    };
  }

  classifyError(error: Error): ErrorType {
    if (error instanceof TestFailureError) return 'test-failure';
    if (error instanceof BuildError) return 'build-error';
    if (error instanceof GitError) return 'git-error';
    if (error instanceof ClaudeAPIError) return 'claude-api-error';
    if (error instanceof GitHubAPIError) return 'github-api-error';
    if (error.message.includes('timeout')) return 'timeout';
    return 'unknown';
  }

  async commentOnIssue(
    issueNumber: number,
    error: Error,
    errorType: ErrorType,
    githubClient: GitHubClient
  ): Promise<void> {
    const comment = `
âš ï¸ è‡ªå‹•å®Ÿè£…ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ

**ã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—**: \`${errorType}\`

**ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**:
\`\`\`
${error.message}
\`\`\`

${this.getErrorSuggestion(errorType)}

---
ã“ã®Issueã«ã¯ \`claude-failed\` ãƒ©ãƒ™ãƒ«ãŒä»˜ä¸ã•ã‚Œã¾ã—ãŸã€‚
å•é¡Œã‚’è§£æ±ºå¾Œã€ãƒ©ãƒ™ãƒ«ã‚’å‰Šé™¤ã—ã¦å†å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
`.trim();

    await githubClient.addComment(issueNumber, comment);
  }

  getErrorSuggestion(errorType: ErrorType): string {
    const suggestions = {
      'test-failure': '**å¯¾å¿œ**: ãƒ†ã‚¹ãƒˆãŒå¤±æ•—ã—ã¾ã—ãŸã€‚Issueã®è¦ä»¶ã‚’è¦‹ç›´ã™ã‹ã€ãƒ†ã‚¹ãƒˆã‚’ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚',
      'build-error': '**å¯¾å¿œ**: ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ä¾å­˜é–¢ä¿‚ã‚„è¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚',
      'git-error': '**å¯¾å¿œ**: Gitæ“ä½œã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒ–ãƒ©ãƒ³ãƒã‚„ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚',
      'claude-api-error': '**å¯¾å¿œ**: Claude APIã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚„APIã‚­ãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚',
      'github-api-error': '**å¯¾å¿œ**: GitHub APIã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒˆãƒ¼ã‚¯ãƒ³ã‚„æ¨©é™ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚',
      'timeout': '**å¯¾å¿œ**: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚Issueã®è¤‡é›‘ã•ã‚’è¦‹ç›´ã™ã‹ã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ã‚’å»¶ã°ã—ã¦ãã ã•ã„ã€‚',
      'unknown': '**å¯¾å¿œ**: äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚',
    };

    return suggestions[errorType] || suggestions['unknown'];
  }
}
```

## 5. çµ±è¨ˆã¨ãƒ¬ãƒãƒ¼ãƒˆ

### 5.1 çµ±è¨ˆåé›†

```typescript
class Statistics {
  private results: ProcessResult[] = [];
  private startTime: number = Date.now();

  recordSuccess(issueNumber: number, duration: number): void {
    this.results.push({
      success: true,
      issueNumber,
      duration,
    });
  }

  recordFailure(
    issueNumber: number,
    errorType: ErrorType,
    duration: number
  ): void {
    this.results.push({
      success: false,
      issueNumber,
      errorType,
      duration,
    });
  }

  generateReport(): Report {
    const totalTime = Date.now() - this.startTime;
    const successful = this.results.filter(r => r.success);
    const failed = this.results.filter(r => !r.success);

    return {
      total: this.results.length,
      successful: successful.length,
      failed: failed.length,
      successRate: (successful.length / this.results.length) * 100,
      averageTime: successful.reduce((sum, r) => sum + r.duration, 0) / successful.length,
      totalTime,
      results: this.results,
    };
  }
}
```

### 5.2 ãƒ¬ãƒãƒ¼ãƒˆå‡ºåŠ›

```typescript
function printReport(report: Report): void {
  console.log('\n' + '='.repeat(60));
  console.log('Claude Runner - å®Ÿè¡Œãƒ¬ãƒãƒ¼ãƒˆ');
  console.log('='.repeat(60));
  console.log();
  console.log(`ç·å®Ÿè¡Œæ™‚é–“: ${formatDuration(report.totalTime)}`);
  console.log(`å‡¦ç†ä»¶æ•°: ${report.total}`);
  console.log(`æˆåŠŸ: ${report.successful} (${report.successRate.toFixed(1)}%)`);
  console.log(`å¤±æ•—: ${report.failed}`);
  console.log(`å¹³å‡å‡¦ç†æ™‚é–“: ${formatDuration(report.averageTime)}`);
  console.log();

  if (report.failed > 0) {
    console.log('å¤±æ•—ã—ãŸIssue:');
    report.results
      .filter(r => !r.success)
      .forEach(r => {
        console.log(`  - Issue #${r.issueNumber}: ${r.errorType}`);
      });
    console.log();
  }

  console.log('='.repeat(60));
}

function formatDuration(ms: number): string {
  const seconds = Math.floor(ms / 1000);
  const minutes = Math.floor(seconds / 60);
  const hours = Math.floor(minutes / 60);

  if (hours > 0) {
    return `${hours}æ™‚é–“${minutes % 60}åˆ†${seconds % 60}ç§’`;
  }
  if (minutes > 0) {
    return `${minutes}åˆ†${seconds % 60}ç§’`;
  }
  return `${seconds}ç§’`;
}
```

## 6. é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 

### 6.1 Slacké€šçŸ¥

```typescript
async function sendSlackNotification(
  issue: Issue,
  result: ProcessResult,
  config: Config
): Promise<void> {
  if (!config.notification?.enabled) return;

  const slack = config.notification.slack;
  if (!slack?.webhookUrl) return;

  // æˆåŠŸæ™‚ã®é€šçŸ¥ã‚’ç„¡åŠ¹ã«ã—ã¦ã„ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
  if (result.success && !slack.onSuccess) return;
  if (!result.success && !slack.onFailure) return;

  const message = result.success
    ? buildSuccessMessage(issue, result)
    : buildFailureMessage(issue, result);

  await fetch(slack.webhookUrl, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(message),
  });
}

function buildSuccessMessage(issue: Issue, result: ProcessResult) {
  return {
    text: `âœ… Issue #${issue.number} ã®å®Ÿè£…ãŒå®Œäº†ã—ã¾ã—ãŸ`,
    blocks: [
      {
        type: 'section',
        text: {
          type: 'mrkdwn',
          text: `*âœ… Issue #${issue.number} å®Ÿè£…å®Œäº†*\n${issue.title}`,
        },
      },
      {
        type: 'section',
        fields: [
          {
            type: 'mrkdwn',
            text: `*å‡¦ç†æ™‚é–“*\n${formatDuration(result.duration)}`,
          },
          {
            type: 'mrkdwn',
            text: `*PR*\n<${result.prUrl}|View PR>`,
          },
        ],
      },
    ],
  };
}
```

## ã¾ã¨ã‚

ã“ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«ã‚ˆã‚Šã€GitHub Issueã®è‡ªå‹•å®Ÿè£…ã‹ã‚‰ PRä½œæˆã¾ã§ã€äººé–“ã®ä»‹å…¥ã‚’æœ€å°é™ã«ã—ãŸã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ã®è‡ªå‹•åŒ–ãŒå®Ÿç¾ã§ãã¾ã™ã€‚å„ãƒ•ã‚§ãƒ¼ã‚ºã§ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒ­ã‚®ãƒ³ã‚°ã«ã‚ˆã‚Šã€å•é¡Œã®ç‰¹å®šã¨ä¿®æ­£ã‚‚å®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚
